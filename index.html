<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GoalLive PRO | البث الاحترافي النهائي</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

    <style>
        :root {
            --primary: #ff6600;
            --bg-dark: #05070a;
            --bg-card: #0d1117;
            --text-main: #ffffff;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background-color: var(--bg-dark); color: var(--text-main); overflow-x: hidden; }
        .container { width: 95%; max-width: 1100px; margin: 0 auto; }

        /* Header */
        .main-header { background: #0d1117; padding: 15px 0; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .header-flex { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 900; }
        .logo span { color: var(--primary); }

        /* Match Grid */
        .match-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; padding: 30px 0; }
        .match-card { background: var(--bg-card); border-radius: 20px; padding: 25px; border: 1px solid var(--glass); cursor: pointer; transition: 0.3s; text-align: center; }
        .match-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .team-row { display: flex; justify-content: space-around; align-items: center; margin-bottom: 15px; }
        .team-row img { width: 60px; height: 60px; object-fit: contain; }
        .vs-badge { background: #1a1f26; color: var(--primary); padding: 5px 15px; border-radius: 10px; font-weight: 900; }

        /* Player Wrapper */
        .player-wrapper { display: none; margin: 20px 0 50px; background: #000; border-radius: 25px; overflow: hidden; border: 1px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .player-header { background: #1a1f26; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .back-btn { background: var(--primary); color: #000; border: none; padding: 8px 18px; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; }
        
        .video-container { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        
        .servers-bar { background: #11151c; padding: 15px; display: flex; gap: 10px; overflow-x: auto; border-top: 1px solid #333; }
        .srv-btn { background: #252a33; color: #fff; border: none; padding: 10px 20px; border-radius: 10px; white-space: nowrap; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.3s; }
        .srv-btn.active { background: var(--primary); color: #000; }

        /* Ad Overlay */
        .global-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(15px); }
        .overlay-card { background: var(--bg-card); width: 90%; max-width: 420px; padding: 30px; border-radius: 30px; border: 1px solid var(--primary); text-align: center; }
        .timer-ring { width: 60px; height: 60px; border: 4px solid var(--primary); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 26px; font-weight: 900; color: var(--primary); }
        .skip-btn { background: var(--primary); color: #000; border: none; padding: 18px; border-radius: 15px; font-weight: 900; width: 100%; cursor: pointer; margin-top: 20px; }
        .skip-btn:disabled { background: #333; color: #666; }

        /* Customizing Plyr Primary Color */
        :root { --plyr-color-main: #ff6600; }
    </style>
</head>
<body>

    <div id="global-ad-overlay" class="global-overlay">
        <div class="overlay-card">
            <div class="timer-ring" id="ad-timer">10</div>
            <h3>جاري تجهيز السيرفر...</h3>
            <div style="background:#000; height:160px; border-radius:15px; margin:20px 0; overflow:hidden;">
                <script>
                (function(rhlive){
                var d = document, s = d.createElement('script'), l = d.scripts[d.scripts.length - 1];
                s.settings = rhlive || {};
                s.src = "\/\/pastchannel.com\/bkXEV\/sHd.Glls0MYwWDco\/xeymi9Zu_ZmUZlykbPfToYB3kNBzZkQ3PNCDZUZtdNPjAcq3hODTmcu0aO\/QH";
                s.async = true; s.referrerPolicy = 'no-referrer-when-downgrade';
                l.parentNode.insertBefore(s, l);
                })({})
                </script>
            </div>
            <button id="skip-btn" class="skip-btn" disabled>يرجى الانتظار...</button>
        </div>
    </div>

    <header class="main-header">
        <div class="container header-flex">
            <div class="logo">GOAL<span>LIVE</span> PRO</div>
            <div style="font-size: 13px;"><i class="fas fa-circle" style="color:red; animation: blink 1s infinite;"></i> مباشر</div>
        </div>
    </header>

    <div class="container">
        <div id="player-wrapper" class="player-wrapper">
            <div class="player-header">
                <button class="back-btn" onclick="closePlayer()"><i class="fas fa-arrow-right"></i> الرئيسية</button>
                <div id="match-title-ui" style="font-weight: bold; font-size: 14px;"></div>
            </div>
            <div class="video-container" id="video-root"></div>
            <div id="servers-bar" class="servers-bar"></div>
        </div>

        <div id="match-grid" class="match-grid">
            <center style="grid-column: 1/-1; padding: 50px;">جاري تحميل جدول المباريات...</center>
        </div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQTA1AfMuoKpNaNWmGvHet37YlVYE1ozZQt43OGy9bjNd-9a7YiHyKf2xp3MHzf_WoAagroiGceF1co/pub?output=csv';
        let matches = [];
        let plyrPlayer;

        async function init() {
            try {
                const res = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(SHEET_URL));
                const data = await res.text();
                const rows = data.split(/\r?\n/).slice(1);
                matches = rows.map(r => {
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    const clean = (v) => v ? v.replace(/^"|"$/g, '').trim() : "";
                    return { t1: clean(c[0]), l1: clean(c[1]), t2: clean(c[2]), l2: clean(c[3]), time: clean(c[4]), links: [clean(c[5]), clean(c[6])] };
                }).filter(m => m.t1);
                render();
            } catch (e) { console.error("Error"); }
        }

        function render() {
            const grid = document.getElementById('match-grid');
            grid.innerHTML = matches.map((m, i) => `
                <div class="match-card" onclick="openAd(${i})">
                    <div class="team-row">
                        <div><img src="${m.l1}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/33/33736.png'"><br><b>${m.t1}</b></div>
                        <div class="vs-badge">VS</div>
                        <div><img src="${m.l2}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/33/33736.png'"><br><b>${m.t2}</b></div>
                    </div>
                    <div style="font-size:12px; color:#888;">${m.time}</div>
                </div>
            `).join('');
        }

        function openAd(idx) {
            const ov = document.getElementById('global-ad-overlay');
            const btn = document.getElementById('skip-btn');
            const timer = document.getElementById('ad-timer');
            ov.style.display = 'flex';
            let c = 10;
            btn.disabled = true;
            const t = setInterval(() => {
                c--; timer.innerText = c;
                if(c<=0) {
                    clearInterval(t); btn.disabled = false; btn.innerText = "دخول البث المباشر";
                    btn.onclick = () => { ov.style.display = 'none'; startStream(idx); };
                }
            }, 1000);
        }

        function startStream(idx) {
            const m = matches[idx];
            document.getElementById('match-grid').style.display = 'none';
            document.getElementById('player-wrapper').style.display = 'block';
            document.getElementById('match-title-ui').innerText = m.t1 + " ⚔️ " + m.t2;
            
            const links = m.links.filter(l => l && l.length > 5);
            const srvBar = document.getElementById('servers-bar');
            srvBar.innerHTML = links.map((l, i) => `
                <button class="srv-btn ${i===0?'active':''}" onclick="loadSource('${l}', this)">سيرفر ${i+1}</button>
            `).join('');

            loadSource(links[0]);
        }

        function loadSource(url, btn) {
            if(btn) {
                document.querySelectorAll('.srv-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            
            const root = document.getElementById('video-root');
            root.innerHTML = ''; 

            // التحقق إذا كان الرابط فيديو مباشر (m3u8, mp4, ts, etc)
            const isDirectVideo = url.toLowerCase().match(/\.(m3u8|mp4|ts|mkv|avi)/) || url.includes('http');

            if (url.includes('m3u8') || url.includes('.ts')) {
                const vid = document.createElement('video');
                vid.id = 'plyr-player';
                vid.controls = true;
                vid.playsinline = true;
                root.appendChild(vid);

                // تفعيل مشغل Plyr مع الأزرار
                plyrPlayer = new Plyr(vid, {
                    controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
                    settings: ['quality', 'speed']
                });

                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(vid);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => vid.play());
                } else { vid.src = url; vid.play(); }
            } else {
                // إذا كان رابط iframe أو رابط موقع
                const ifr = document.createElement('iframe');
                ifr.src = url;
                ifr.allowFullscreen = true;
                ifr.setAttribute('allow', 'autoplay; encrypted-media; fullscreen');
                root.appendChild(ifr);
            }
        }

        function closePlayer() {
            if(plyrPlayer) plyrPlayer.destroy();
            document.getElementById('player-wrapper').style.display = 'none';
            document.getElementById('match-grid').style.display = 'grid';
            document.getElementById('video-root').innerHTML = '';
        }

        window.onload = init;
    </script>

    <style>@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }</style>
</body>
</html>
