<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIVE PLAYER | البث المباشر</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { font-family: sans-serif; background-color: #020617; color: white; margin: 0; }
        #video-box { width: 100%; aspect-ratio: 16/9; background: #000; position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #f97316; }
        video { width: 100%; height: 100%; }
        .match-card { background: #0f172a; border-radius: 12px; padding: 15px; cursor: pointer; border: 1px solid #1e293b; margin-bottom: 10px; }
        .match-card:active { transform: scale(0.98); background: #1e293b; }
    </style>
</head>
<body>

    <div id="video-box">
        <video id="video" controls autoplay playsinline></video>
    </div>

    <div class="p-4 max-w-md mx-auto">
        <h1 class="text-xl font-bold text-orange-500 mb-4 text-center italic font-black">GOAL LIVE PRO</h1>
        <div id="match-list">
            <p class="text-center text-gray-500">جاري تحميل المباريات...</p>
        </div>
    </div>

    <script>
        const SERVER = "http://hikcoo.xyz:8080";
        const USER = "2171855479556216";
        const PASS = "6019132685779108";
        const SHEET_API = "https://api.sheetbest.com/sheets/313e8eb7-119d-43a8-90da-84017bbe3e89";

        const video = document.getElementById('video');

        function playStream(id) {
            // تنظيف الرابط باش نحيدو أي فراغات
            const streamUrl = `${SERVER}/live/${USER}/${PASS}/${id.trim()}.m3u8`;
            
            if (Hls.isSupported()) {
                const hls = new Hls({
                    xhrSetup: function(xhr, url) {
                        xhr.withCredentials = false; // مهم لتخطي بعض أنواع الحظر
                    }
                });
                hls.loadSource(streamUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play();
                });
                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        console.log("حدث خطأ في البث، قد يكون السيرفر متوقف أو محظور.");
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = streamUrl;
                video.addEventListener('loadedmetadata', function() {
                    video.play();
                });
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function getMatches() {
            try {
                const res = await fetch(SHEET_API);
                const data = await res.json();
                const list = document.getElementById('match-list');
                list.innerHTML = "";

                data.forEach(m => {
                    const card = document.createElement('div');
                    card.className = "match-card";
                    card.onclick = () => playStream(m.streams);
                    card.innerHTML = `
                        <div class="flex justify-between items-center text-sm font-bold">
                            <span>${m.team1}</span>
                            <span class="text-orange-500 bg-orange-500/10 px-2 py-1 rounded">${m.time}</span>
                            <span>${m.team2}</span>
                        </div>
                    `;
                    list.appendChild(card);
                });
            } catch (e) {
                document.getElementById('match-list').innerHTML = "خطأ في الاتصال بالجدول!";
            }
        }

        getMatches();
    </script>
</body>
</html>
