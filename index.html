<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOAL LIVE | PRO PLAYER</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { background-color: #050a12; color: white; font-family: sans-serif; }
        .player-container { width: 100%; max-width: 700px; margin: 0 auto; sticky top: 0; z-index: 50; }
        .match-list { max-width: 600px; margin: 20px auto; padding: 10px; }
        .match-item { background: #101927; border: 1px solid #1e293b; padding: 15px; border-radius: 12px; cursor: pointer; margin-bottom: 10px; transition: 0.3s; }
        .match-item:hover { border-color: #f97316; background: #162031; }
    </style>
</head>
<body>

    <div class="player-container">
        <video id="player" playsinline controls data-poster="https://bit.ly/3Ym8S7G"></video>
    </div>

    <div class="match-list">
        <h2 class="text-orange-500 font-black mb-4 tracking-tighter italic text-xl">مباريات اليوم المباشرة</h2>
        <div id="matches">
            <p class="text-gray-600 text-center">جاري جلب القنوات من الجدول...</p>
        </div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script>
        const video = document.getElementById('player');
        const SHEET_API = "https://api.sheetbest.com/sheets/313e8eb7-119d-43a8-90da-84017bbe3e89";
        
        // إعداد المشغل
        const player = new Plyr(video, {
            captions: { active: true, update: true, language: 'en' },
            tooltips: { controls: true, seek: true }
        });

        // وظيفة تشغيل الرابط
        function playStream(url) {
            if (Hls.isSupported()) {
                const hls = new Hls({
                    xhrSetup: function(xhr, url) {
                        // محاولة تخطي CORS
                        xhr.withCredentials = false;
                    }
                });
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // جلب البيانات من Google Sheets
        async function fetchMatches() {
            try {
                const res = await fetch(SHEET_API);
                const data = await res.json();
                const container = document.getElementById('matches');
                container.innerHTML = "";

                data.forEach(m => {
                    const div = document.createElement('div');
                    div.className = "match-item flex justify-between items-center";
                    // نأخذ الرابط من عمود streams في الجدول
                    div.onclick = () => playStream(m.streams);
                    div.innerHTML = `
                        <div class="font-bold text-sm">${m.team1}</div>
                        <div class="text-xs bg-orange-600/20 text-orange-500 px-2 py-1 rounded font-black">${m.time}</div>
                        <div class="font-bold text-sm text-left">${m.team2}</div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                document.getElementById('matches').innerHTML = "خطأ في الاتصال بالجدول!";
            }
        }

        fetchMatches();
    </script>
</body>
</html>
